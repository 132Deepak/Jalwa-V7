<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalwa Pro - Deposit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { 
            --bg: #0a0e17; 
            --card-bg: #161d2b; 
            --primary: #ffcc00; 
            --text-gray: #a4b0be;
            --success: #2ecc71;
            --gradient: linear-gradient(135deg, #ffcc00 0%, #ff9900 100%);
        }

        body { margin: 0; background: var(--bg); font-family: 'Poppins', sans-serif; color: white; overflow-x: hidden; }
        .app-container { width: 100%; max-width: 480px; margin: auto; min-height: 100vh; padding-bottom: 50px; }

        /* --- HEADER --- */
        .header { padding: 20px; display: flex; align-items: center; justify-content: space-between; background: #1e272e; border-bottom: 1px solid rgba(255, 204, 0, 0.2); }
        .header b { font-size: 18px; letter-spacing: 1px; }

        /* --- QR SECTION --- */
        .qr-section { margin: 20px 15px; background: white; border-radius: 20px; padding: 20px; text-align: center; color: #333; box-shadow: 0 0 20px rgba(255, 204, 0, 0.1); }
        .qr-section img { width: 80%; border-radius: 10px; margin: 10px 0; }
        .upi-box { background: #f1f2f6; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px dashed #000; margin-top: 10px; }
        .upi-id { font-weight: 800; font-size: 14px; color: #000; }

        /* --- INPUT FORM --- */
        .deposit-form { padding: 0 15px; margin-top: 25px; }
        .step-label { color: var(--primary); font-size: 14px; font-weight: bold; margin-bottom: 10px; display: block; }
        .input-group { background: var(--card-bg); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.05); margin-bottom: 15px; overflow: hidden; }
        input { width: 100%; padding: 15px; background: transparent; border: none; color: white; outline: none; font-size: 15px; }
        input::placeholder { color: #5a658a; }

        .btn-submit { width: 100%; padding: 16px; background: var(--gradient); border: none; border-radius: 15px; color: #000; font-weight: 900; font-size: 16px; cursor: pointer; text-transform: uppercase; box-shadow: 0 5px 20px rgba(255, 204, 0, 0.3); margin-top: 10px; }
        .btn-submit:active { transform: scale(0.97); }

        /* --- HISTORY SECTION --- */
        .history-section { padding: 0 15px; margin-top: 40px; }
        .hist-title { font-size: 16px; color: var(--primary); font-weight: bold; margin-bottom: 15px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .hist-card { background: var(--card-bg); padding: 15px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.05); margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .hist-info b { font-size: 16px; color: #fff; }
        .hist-info p { font-size: 11px; color: var(--text-gray); margin: 3px 0; }
        .status { padding: 4px 10px; border-radius: 5px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .pending { background: rgba(255, 204, 0, 0.15); color: var(--primary); }
        .approved { background: rgba(46, 204, 113, 0.15); color: var(--success); }
        .rejected { background: rgba(231, 76, 60, 0.15); color: #ff4757; }

        /* --- TOAST --- */
        #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #000; padding: 10px 25px; border-radius: 10px; font-weight: 800; display: none; z-index: 1000; }
    </style>
</head>
<body>

<div id="toast">Message</div>

<div class="app-container">
    <!-- Header -->
    <div class="header">
        <i class="fas fa-chevron-left" onclick="history.back()" style="color: var(--primary);"></i>
        <b>RECHARGE</b>
        <i class="fas fa-headset" style="color: var(--text-gray);" onclick="location.href='support.html'"></i>
    </div>

    <!-- QR Section -->
    <div class="qr-section">
        <p style="font-weight: bold; margin: 0;">Scan QR to Pay</p>
        <!-- Aapka QR image -->
        <img src="qr.png" alt="Paytm QR Code">
        
        <div class="upi-box" onclick="copyUPI()">
            <span class="upi-id" id="upiIdText">d28122004@ptyes</span>
            <i class="fas fa-copy" style="color: #0081ff;"></i>
        </div>
        <p style="font-size: 10px; color: #888; margin-top: 10px;">Click UPI ID to copy</p>
    </div>

    <!-- Recharge Form -->
    <div class="deposit-form">
        <span class="step-label">STEP 1: Enter Recharge Amount</span>
        <div class="input-group">
            <input type="number" id="depAmount" placeholder="Min ₹500 - Max ₹50,000">
        </div>

        <span class="step-label">STEP 2: Enter 12 Digit UTR Number</span>
        <div class="input-group">
            <input type="number" id="depUTR" placeholder="Enter Ref/UTR Number After Payment">
        </div>

        <button class="btn-submit" onclick="submitDeposit()">Submit Recharge</button>
        
        <p style="color: var(--text-gray); font-size: 11px; margin-top: 15px; text-align: center;">
            <i class="fas fa-info-circle"></i> Payment approval usually takes 10-30 minutes.
        </p>
    </div>

    <!-- History Section -->
    <div class="history-section">
        <div class="hist-title">Recharge Records</div>
        <div id="depHistoryList">
            <!-- Records will come here from Firebase -->
        </div>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = { databaseURL: "https://jalwa-v2-ad222-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const userPhone = localStorage.getItem('jalwa_user_phone');

    window.onload = function() {
        if(!userPhone) location.href = 'login.html';
        loadDepositHistory();
    };

    function showToast(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    function copyUPI() {
        const upiText = document.getElementById('upiIdText').innerText;
        navigator.clipboard.writeText(upiText);
        showToast("UPI ID Copied!");
    }

    // --- SUBMIT DEPOSIT ---
    async function submitDeposit() {
        const amt = document.getElementById('depAmount').value;
        const utr = document.getElementById('depUTR').value;

        if (amt < 500) return showToast("Min deposit ₹500!");
        if (utr.length < 12) return showToast("Enter valid 12 digit UTR!");

        const depositRequest = {
            userId: userPhone,
            amount: parseFloat(amt),
            utr: utr,
            status: "pending",
            timestamp: Date.now(),
            date: new Date().toLocaleString()
        };

        try {
            // Firebase mein submit karna
            await db.ref('requests/deposits').push(depositRequest);
            
            // Alert for admin
            new Image().src = `https://ntfy.sh/jalwa_master_admin_786/publish?message=New Deposit Request: ₹${amt} by ${userPhone}&priority=4`;
            
            showToast("Request Submitted!");
            document.getElementById('depAmount').value = "";
            document.getElementById('depUTR').value = "";
            
        } catch (e) {
            showToast("Network Error!");
        }
    }

    // --- LOAD HISTORY ---
    function loadDepositHistory() {
        db.ref('requests/deposits').orderByChild('userId').equalTo(userPhone).on('value', snap => {
            let html = "";
            if (!snap.exists()) {
                html = "<p style='text-align:center; color:gray; font-size:12px;'>No records found.</p>";
            } else {
                let records = [];
                snap.forEach(child => { records.push(child.val()); });
                records.reverse().forEach(data => {
                    html += `
                        <div class="hist-card">
                            <div class="hist-info">
                                <b>₹${data.amount.toFixed(2)}</b>
                                <p>UTR: ${data.utr}</p>
                                <p>${data.date}</p>
                            </div>
                            <span class="status ${data.status}">${data.status}</span>
                        </div>
                    `;
                });
            }
            document.getElementById('depHistoryList').innerHTML = html;
        });
    }
</script>

</body>
</html>
